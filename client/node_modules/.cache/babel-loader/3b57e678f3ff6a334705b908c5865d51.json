{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n/**\n * Module of mixed-in functions shared between node and client code\n */\n\n\nvar isObject = require('./is-object');\n/**\n * Expose `RequestBase`.\n */\n\n\nmodule.exports = RequestBase;\n/**\n * Initialize a new `RequestBase`.\n *\n * @api public\n */\n\nfunction RequestBase(object) {\n  if (object) return mixin(object);\n}\n/**\n * Mixin the prototype properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\n\nfunction mixin(object) {\n  for (var key in RequestBase.prototype) {\n    if (Object.prototype.hasOwnProperty.call(RequestBase.prototype, key)) object[key] = RequestBase.prototype[key];\n  }\n\n  return object;\n}\n/**\n * Clear previous timeout.\n *\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.clearTimeout = function () {\n  clearTimeout(this._timer);\n  clearTimeout(this._responseTimeoutTimer);\n  clearTimeout(this._uploadTimeoutTimer);\n  delete this._timer;\n  delete this._responseTimeoutTimer;\n  delete this._uploadTimeoutTimer;\n  return this;\n};\n/**\n * Override default response body parser\n *\n * This function will be called to convert incoming data into request.body\n *\n * @param {Function}\n * @api public\n */\n\n\nRequestBase.prototype.parse = function (fn) {\n  this._parser = fn;\n  return this;\n};\n/**\n * Set format of binary response body.\n * In browser valid formats are 'blob' and 'arraybuffer',\n * which return Blob and ArrayBuffer, respectively.\n *\n * In Node all values result in Buffer.\n *\n * Examples:\n *\n *      req.get('/')\n *        .responseType('blob')\n *        .end(callback);\n *\n * @param {String} val\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.responseType = function (value) {\n  this._responseType = value;\n  return this;\n};\n/**\n * Override default request body serializer\n *\n * This function will be called to convert data set via .send or .attach into payload to send\n *\n * @param {Function}\n * @api public\n */\n\n\nRequestBase.prototype.serialize = function (fn) {\n  this._serializer = fn;\n  return this;\n};\n/**\n * Set timeouts.\n *\n * - response timeout is time between sending request and receiving the first byte of the response. Includes DNS and connection time.\n * - deadline is the time from start of the request to receiving response body in full. If the deadline is too short large files may not load at all on slow connections.\n * - upload is the time  since last bit of data was sent or received. This timeout works only if deadline timeout is off\n *\n * Value of 0 or false means no timeout.\n *\n * @param {Number|Object} ms or {response, deadline}\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.timeout = function (options) {\n  if (!options || _typeof(options) !== 'object') {\n    this._timeout = options;\n    this._responseTimeout = 0;\n    this._uploadTimeout = 0;\n    return this;\n  }\n\n  for (var option in options) {\n    if (Object.prototype.hasOwnProperty.call(options, option)) {\n      switch (option) {\n        case 'deadline':\n          this._timeout = options.deadline;\n          break;\n\n        case 'response':\n          this._responseTimeout = options.response;\n          break;\n\n        case 'upload':\n          this._uploadTimeout = options.upload;\n          break;\n\n        default:\n          console.warn('Unknown timeout option', option);\n      }\n    }\n  }\n\n  return this;\n};\n/**\n * Set number of retry attempts on error.\n *\n * Failed requests will be retried 'count' times if timeout or err.code >= 500.\n *\n * @param {Number} count\n * @param {Function} [fn]\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.retry = function (count, fn) {\n  // Default to 1 if no count passed or true\n  if (arguments.length === 0 || count === true) count = 1;\n  if (count <= 0) count = 0;\n  this._maxRetries = count;\n  this._retries = 0;\n  this._retryCallback = fn;\n  return this;\n}; //\n// NOTE: we do not include ESOCKETTIMEDOUT because that is from `request` package\n//       <https://github.com/sindresorhus/got/pull/537>\n//\n// NOTE: we do not include EADDRINFO because it was removed from libuv in 2014\n//       <https://github.com/libuv/libuv/commit/02e1ebd40b807be5af46343ea873331b2ee4e9c1>\n//       <https://github.com/request/request/search?q=ESOCKETTIMEDOUT&unscoped_q=ESOCKETTIMEDOUT>\n//\n//\n// TODO: expose these as configurable defaults\n//\n\n\nvar ERROR_CODES = new Set(['ETIMEDOUT', 'ECONNRESET', 'EADDRINUSE', 'ECONNREFUSED', 'EPIPE', 'ENOTFOUND', 'ENETUNREACH', 'EAI_AGAIN']);\nvar STATUS_CODES = new Set([408, 413, 429, 500, 502, 503, 504, 521, 522, 524]); // TODO: we would need to make this easily configurable before adding it in (e.g. some might want to add POST)\n// const METHODS = new Set(['GET', 'PUT', 'HEAD', 'DELETE', 'OPTIONS', 'TRACE']);\n\n/**\n * Determine if a request should be retried.\n * (Inspired by https://github.com/sindresorhus/got#retry)\n *\n * @param {Error} err an error\n * @param {Response} [res] response\n * @returns {Boolean} if segment should be retried\n */\n\nRequestBase.prototype._shouldRetry = function (err, res) {\n  if (!this._maxRetries || this._retries++ >= this._maxRetries) {\n    return false;\n  }\n\n  if (this._retryCallback) {\n    try {\n      var override = this._retryCallback(err, res);\n\n      if (override === true) return true;\n      if (override === false) return false; // undefined falls back to defaults\n    } catch (err_) {\n      console.error(err_);\n    }\n  } // TODO: we would need to make this easily configurable before adding it in (e.g. some might want to add POST)\n\n  /*\n  if (\n    this.req &&\n    this.req.method &&\n    !METHODS.has(this.req.method.toUpperCase())\n  )\n    return false;\n  */\n\n\n  if (res && res.status && STATUS_CODES.has(res.status)) return true;\n\n  if (err) {\n    if (err.code && ERROR_CODES.has(err.code)) return true; // Superagent timeout\n\n    if (err.timeout && err.code === 'ECONNABORTED') return true;\n    if (err.crossDomain) return true;\n  }\n\n  return false;\n};\n/**\n * Retry request\n *\n * @return {Request} for chaining\n * @api private\n */\n\n\nRequestBase.prototype._retry = function () {\n  this.clearTimeout(); // node\n\n  if (this.req) {\n    this.req = null;\n    this.req = this.request();\n  }\n\n  this._aborted = false;\n  this.timedout = false;\n  this.timedoutError = null;\n  return this._end();\n};\n/**\n * Promise support\n *\n * @param {Function} resolve\n * @param {Function} [reject]\n * @return {Request}\n */\n\n\nRequestBase.prototype.then = function (resolve, reject) {\n  var _this = this;\n\n  if (!this._fullfilledPromise) {\n    var self = this;\n\n    if (this._endCalled) {\n      console.warn('Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises');\n    }\n\n    this._fullfilledPromise = new Promise(function (resolve, reject) {\n      self.on('abort', function () {\n        if (_this._maxRetries && _this._maxRetries > _this._retries) {\n          return;\n        }\n\n        if (_this.timedout && _this.timedoutError) {\n          reject(_this.timedoutError);\n          return;\n        }\n\n        var err = new Error('Aborted');\n        err.code = 'ABORTED';\n        err.status = _this.status;\n        err.method = _this.method;\n        err.url = _this.url;\n        reject(err);\n      });\n      self.end(function (err, res) {\n        if (err) reject(err);else resolve(res);\n      });\n    });\n  }\n\n  return this._fullfilledPromise.then(resolve, reject);\n};\n\nRequestBase.prototype.catch = function (cb) {\n  return this.then(undefined, cb);\n};\n/**\n * Allow for extension\n */\n\n\nRequestBase.prototype.use = function (fn) {\n  fn(this);\n  return this;\n};\n\nRequestBase.prototype.ok = function (cb) {\n  if (typeof cb !== 'function') throw new Error('Callback required');\n  this._okCallback = cb;\n  return this;\n};\n\nRequestBase.prototype._isResponseOK = function (res) {\n  if (!res) {\n    return false;\n  }\n\n  if (this._okCallback) {\n    return this._okCallback(res);\n  }\n\n  return res.status >= 200 && res.status < 300;\n};\n/**\n * Get request header `field`.\n * Case-insensitive.\n *\n * @param {String} field\n * @return {String}\n * @api public\n */\n\n\nRequestBase.prototype.get = function (field) {\n  return this._header[field.toLowerCase()];\n};\n/**\n * Get case-insensitive header `field` value.\n * This is a deprecated internal API. Use `.get(field)` instead.\n *\n * (getHeader is no longer used internally by the superagent code base)\n *\n * @param {String} field\n * @return {String}\n * @api private\n * @deprecated\n */\n\n\nRequestBase.prototype.getHeader = RequestBase.prototype.get;\n/**\n * Set header `field` to `val`, or multiple fields with one object.\n * Case-insensitive.\n *\n * Examples:\n *\n *      req.get('/')\n *        .set('Accept', 'application/json')\n *        .set('X-API-Key', 'foobar')\n *        .end(callback);\n *\n *      req.get('/')\n *        .set({ Accept: 'application/json', 'X-API-Key': 'foobar' })\n *        .end(callback);\n *\n * @param {String|Object} field\n * @param {String} val\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.set = function (field, value) {\n  if (isObject(field)) {\n    for (var key in field) {\n      if (Object.prototype.hasOwnProperty.call(field, key)) this.set(key, field[key]);\n    }\n\n    return this;\n  }\n\n  this._header[field.toLowerCase()] = value;\n  this.header[field] = value;\n  return this;\n};\n/**\n * Remove header `field`.\n * Case-insensitive.\n *\n * Example:\n *\n *      req.get('/')\n *        .unset('User-Agent')\n *        .end(callback);\n *\n * @param {String} field field name\n */\n\n\nRequestBase.prototype.unset = function (field) {\n  delete this._header[field.toLowerCase()];\n  delete this.header[field];\n  return this;\n};\n/**\n * Write the field `name` and `val`, or multiple fields with one object\n * for \"multipart/form-data\" request bodies.\n *\n * ``` js\n * request.post('/upload')\n *   .field('foo', 'bar')\n *   .end(callback);\n *\n * request.post('/upload')\n *   .field({ foo: 'bar', baz: 'qux' })\n *   .end(callback);\n * ```\n *\n * @param {String|Object} name name of field\n * @param {String|Blob|File|Buffer|fs.ReadStream} val value of field\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.field = function (name, value) {\n  // name should be either a string or an object.\n  if (name === null || undefined === name) {\n    throw new Error('.field(name, val) name can not be empty');\n  }\n\n  if (this._data) {\n    throw new Error(\".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()\");\n  }\n\n  if (isObject(name)) {\n    for (var key in name) {\n      if (Object.prototype.hasOwnProperty.call(name, key)) this.field(key, name[key]);\n    }\n\n    return this;\n  }\n\n  if (Array.isArray(value)) {\n    for (var i in value) {\n      if (Object.prototype.hasOwnProperty.call(value, i)) this.field(name, value[i]);\n    }\n\n    return this;\n  } // val should be defined now\n\n\n  if (value === null || undefined === value) {\n    throw new Error('.field(name, val) val can not be empty');\n  }\n\n  if (typeof value === 'boolean') {\n    value = String(value);\n  }\n\n  this._getFormData().append(name, value);\n\n  return this;\n};\n/**\n * Abort the request, and clear potential timeout.\n *\n * @return {Request} request\n * @api public\n */\n\n\nRequestBase.prototype.abort = function () {\n  if (this._aborted) {\n    return this;\n  }\n\n  this._aborted = true;\n  if (this.xhr) this.xhr.abort(); // browser\n\n  if (this.req) this.req.abort(); // node\n\n  this.clearTimeout();\n  this.emit('abort');\n  return this;\n};\n\nRequestBase.prototype._auth = function (user, pass, options, base64Encoder) {\n  switch (options.type) {\n    case 'basic':\n      this.set('Authorization', \"Basic \".concat(base64Encoder(\"\".concat(user, \":\").concat(pass))));\n      break;\n\n    case 'auto':\n      this.username = user;\n      this.password = pass;\n      break;\n\n    case 'bearer':\n      // usage would be .auth(accessToken, { type: 'bearer' })\n      this.set('Authorization', \"Bearer \".concat(user));\n      break;\n\n    default:\n      break;\n  }\n\n  return this;\n};\n/**\n * Enable transmission of cookies with x-domain requests.\n *\n * Note that for this to work the origin must not be\n * using \"Access-Control-Allow-Origin\" with a wildcard,\n * and also must set \"Access-Control-Allow-Credentials\"\n * to \"true\".\n *\n * @api public\n */\n\n\nRequestBase.prototype.withCredentials = function (on) {\n  // This is browser-only functionality. Node side is no-op.\n  if (on === undefined) on = true;\n  this._withCredentials = on;\n  return this;\n};\n/**\n * Set the max redirects to `n`. Does nothing in browser XHR implementation.\n *\n * @param {Number} n\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.redirects = function (n) {\n  this._maxRedirects = n;\n  return this;\n};\n/**\n * Maximum size of buffered response body, in bytes. Counts uncompressed size.\n * Default 200MB.\n *\n * @param {Number} n number of bytes\n * @return {Request} for chaining\n */\n\n\nRequestBase.prototype.maxResponseSize = function (n) {\n  if (typeof n !== 'number') {\n    throw new TypeError('Invalid argument');\n  }\n\n  this._maxResponseSize = n;\n  return this;\n};\n/**\n * Convert to a plain javascript object (not JSON string) of scalar properties.\n * Note as this method is designed to return a useful non-this value,\n * it cannot be chained.\n *\n * @return {Object} describing method, url, and data of this request\n * @api public\n */\n\n\nRequestBase.prototype.toJSON = function () {\n  return {\n    method: this.method,\n    url: this.url,\n    data: this._data,\n    headers: this._header\n  };\n};\n/**\n * Send `data` as the request body, defaulting the `.type()` to \"json\" when\n * an object is given.\n *\n * Examples:\n *\n *       // manual json\n *       request.post('/user')\n *         .type('json')\n *         .send('{\"name\":\"tj\"}')\n *         .end(callback)\n *\n *       // auto json\n *       request.post('/user')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // manual x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send('name=tj')\n *         .end(callback)\n *\n *       // auto x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // defaults to x-www-form-urlencoded\n *      request.post('/user')\n *        .send('name=tobi')\n *        .send('species=ferret')\n *        .end(callback)\n *\n * @param {String|Object} data\n * @return {Request} for chaining\n * @api public\n */\n// eslint-disable-next-line complexity\n\n\nRequestBase.prototype.send = function (data) {\n  var isObject_ = isObject(data);\n  var type = this._header['content-type'];\n\n  if (this._formData) {\n    throw new Error(\".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()\");\n  }\n\n  if (isObject_ && !this._data) {\n    if (Array.isArray(data)) {\n      this._data = [];\n    } else if (!this._isHost(data)) {\n      this._data = {};\n    }\n  } else if (data && this._data && this._isHost(this._data)) {\n    throw new Error(\"Can't merge these send calls\");\n  } // merge\n\n\n  if (isObject_ && isObject(this._data)) {\n    for (var key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) this._data[key] = data[key];\n    }\n  } else if (typeof data === 'string') {\n    // default to x-www-form-urlencoded\n    if (!type) this.type('form');\n    type = this._header['content-type'];\n    if (type) type = type.toLowerCase().trim();\n\n    if (type === 'application/x-www-form-urlencoded') {\n      this._data = this._data ? \"\".concat(this._data, \"&\").concat(data) : data;\n    } else {\n      this._data = (this._data || '') + data;\n    }\n  } else {\n    this._data = data;\n  }\n\n  if (!isObject_ || this._isHost(data)) {\n    return this;\n  } // default to json\n\n\n  if (!type) this.type('json');\n  return this;\n};\n/**\n * Sort `querystring` by the sort function\n *\n *\n * Examples:\n *\n *       // default order\n *       request.get('/user')\n *         .query('name=Nick')\n *         .query('search=Manny')\n *         .sortQuery()\n *         .end(callback)\n *\n *       // customized sort function\n *       request.get('/user')\n *         .query('name=Nick')\n *         .query('search=Manny')\n *         .sortQuery(function(a, b){\n *           return a.length - b.length;\n *         })\n *         .end(callback)\n *\n *\n * @param {Function} sort\n * @return {Request} for chaining\n * @api public\n */\n\n\nRequestBase.prototype.sortQuery = function (sort) {\n  // _sort default to true but otherwise can be a function or boolean\n  this._sort = typeof sort === 'undefined' ? true : sort;\n  return this;\n};\n/**\n * Compose querystring to append to req.url\n *\n * @api private\n */\n\n\nRequestBase.prototype._finalizeQueryString = function () {\n  var query = this._query.join('&');\n\n  if (query) {\n    this.url += (this.url.includes('?') ? '&' : '?') + query;\n  }\n\n  this._query.length = 0; // Makes the call idempotent\n\n  if (this._sort) {\n    var index = this.url.indexOf('?');\n\n    if (index >= 0) {\n      var queryArray = this.url.slice(index + 1).split('&');\n\n      if (typeof this._sort === 'function') {\n        queryArray.sort(this._sort);\n      } else {\n        queryArray.sort();\n      }\n\n      this.url = this.url.slice(0, index) + '?' + queryArray.join('&');\n    }\n  }\n}; // For backwards compat only\n\n\nRequestBase.prototype._appendQueryString = function () {\n  console.warn('Unsupported');\n};\n/**\n * Invoke callback with timeout error.\n *\n * @api private\n */\n\n\nRequestBase.prototype._timeoutError = function (reason, timeout, errno) {\n  if (this._aborted) {\n    return;\n  }\n\n  var err = new Error(\"\".concat(reason + timeout, \"ms exceeded\"));\n  err.timeout = timeout;\n  err.code = 'ECONNABORTED';\n  err.errno = errno;\n  this.timedout = true;\n  this.timedoutError = err;\n  this.abort();\n  this.callback(err);\n};\n\nRequestBase.prototype._setTimeouts = function () {\n  var self = this; // deadline\n\n  if (this._timeout && !this._timer) {\n    this._timer = setTimeout(function () {\n      self._timeoutError('Timeout of ', self._timeout, 'ETIME');\n    }, this._timeout);\n  } // response timeout\n\n\n  if (this._responseTimeout && !this._responseTimeoutTimer) {\n    this._responseTimeoutTimer = setTimeout(function () {\n      self._timeoutError('Response timeout of ', self._responseTimeout, 'ETIMEDOUT');\n    }, this._responseTimeout);\n  }\n};","map":{"version":3,"mappings":"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","names":["isObject","require","module","exports","RequestBase","object","mixin","key","prototype","Object","hasOwnProperty","call","clearTimeout","_timer","_responseTimeoutTimer","_uploadTimeoutTimer","parse","fn","_parser","responseType","value","_responseType","serialize","_serializer","timeout","options","_typeof","_timeout","_responseTimeout","_uploadTimeout","option","deadline","response","upload","console","warn","retry","count","arguments","length","_maxRetries","_retries","_retryCallback","ERROR_CODES","Set","STATUS_CODES","_shouldRetry","err","res","override","err_","error","status","has","code","crossDomain","_retry","req","request","_aborted","timedout","timedoutError","_end","then","resolve","reject","_fullfilledPromise","self","_endCalled","Promise","on","_this","Error","method","url","end","catch","cb","undefined","use","ok","_okCallback","_isResponseOK","get","field","_header","toLowerCase","getHeader","set","header","unset","name","_data","Array","isArray","i","String","_getFormData","append","abort","xhr","emit","_auth","user","pass","base64Encoder","type","username","password","withCredentials","_withCredentials","redirects","n","_maxRedirects","maxResponseSize","TypeError","_maxResponseSize","toJSON","data","headers","send","isObject_","_formData","_isHost","trim","sortQuery","sort","_sort","_finalizeQueryString","query","_query","join","includes","index","indexOf","queryArray","slice","split","_appendQueryString","_timeoutError","reason","errno","callback","_setTimeouts","setTimeout"],"sources":["../src/request-base.js"],"sourcesContent":["/**\n * Module of mixed-in functions shared between node and client code\n */\nconst isObject = require('./is-object');\n\n/**\n * Expose `RequestBase`.\n */\n\nmodule.exports = RequestBase;\n\n/**\n * Initialize a new `RequestBase`.\n *\n * @api public\n */\n\nfunction RequestBase(object) {\n  if (object) return mixin(object);\n}\n\n/**\n * Mixin the prototype properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(object) {\n  for (const key in RequestBase.prototype) {\n    if (Object.prototype.hasOwnProperty.call(RequestBase.prototype, key))\n      object[key] = RequestBase.prototype[key];\n  }\n\n  return object;\n}\n\n/**\n * Clear previous timeout.\n *\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.clearTimeout = function () {\n  clearTimeout(this._timer);\n  clearTimeout(this._responseTimeoutTimer);\n  clearTimeout(this._uploadTimeoutTimer);\n  delete this._timer;\n  delete this._responseTimeoutTimer;\n  delete this._uploadTimeoutTimer;\n  return this;\n};\n\n/**\n * Override default response body parser\n *\n * This function will be called to convert incoming data into request.body\n *\n * @param {Function}\n * @api public\n */\n\nRequestBase.prototype.parse = function (fn) {\n  this._parser = fn;\n  return this;\n};\n\n/**\n * Set format of binary response body.\n * In browser valid formats are 'blob' and 'arraybuffer',\n * which return Blob and ArrayBuffer, respectively.\n *\n * In Node all values result in Buffer.\n *\n * Examples:\n *\n *      req.get('/')\n *        .responseType('blob')\n *        .end(callback);\n *\n * @param {String} val\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.responseType = function (value) {\n  this._responseType = value;\n  return this;\n};\n\n/**\n * Override default request body serializer\n *\n * This function will be called to convert data set via .send or .attach into payload to send\n *\n * @param {Function}\n * @api public\n */\n\nRequestBase.prototype.serialize = function (fn) {\n  this._serializer = fn;\n  return this;\n};\n\n/**\n * Set timeouts.\n *\n * - response timeout is time between sending request and receiving the first byte of the response. Includes DNS and connection time.\n * - deadline is the time from start of the request to receiving response body in full. If the deadline is too short large files may not load at all on slow connections.\n * - upload is the time  since last bit of data was sent or received. This timeout works only if deadline timeout is off\n *\n * Value of 0 or false means no timeout.\n *\n * @param {Number|Object} ms or {response, deadline}\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.timeout = function (options) {\n  if (!options || typeof options !== 'object') {\n    this._timeout = options;\n    this._responseTimeout = 0;\n    this._uploadTimeout = 0;\n    return this;\n  }\n\n  for (const option in options) {\n    if (Object.prototype.hasOwnProperty.call(options, option)) {\n      switch (option) {\n        case 'deadline':\n          this._timeout = options.deadline;\n          break;\n        case 'response':\n          this._responseTimeout = options.response;\n          break;\n        case 'upload':\n          this._uploadTimeout = options.upload;\n          break;\n        default:\n          console.warn('Unknown timeout option', option);\n      }\n    }\n  }\n\n  return this;\n};\n\n/**\n * Set number of retry attempts on error.\n *\n * Failed requests will be retried 'count' times if timeout or err.code >= 500.\n *\n * @param {Number} count\n * @param {Function} [fn]\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.retry = function (count, fn) {\n  // Default to 1 if no count passed or true\n  if (arguments.length === 0 || count === true) count = 1;\n  if (count <= 0) count = 0;\n  this._maxRetries = count;\n  this._retries = 0;\n  this._retryCallback = fn;\n  return this;\n};\n\n//\n// NOTE: we do not include ESOCKETTIMEDOUT because that is from `request` package\n//       <https://github.com/sindresorhus/got/pull/537>\n//\n// NOTE: we do not include EADDRINFO because it was removed from libuv in 2014\n//       <https://github.com/libuv/libuv/commit/02e1ebd40b807be5af46343ea873331b2ee4e9c1>\n//       <https://github.com/request/request/search?q=ESOCKETTIMEDOUT&unscoped_q=ESOCKETTIMEDOUT>\n//\n//\n// TODO: expose these as configurable defaults\n//\nconst ERROR_CODES = new Set([\n  'ETIMEDOUT',\n  'ECONNRESET',\n  'EADDRINUSE',\n  'ECONNREFUSED',\n  'EPIPE',\n  'ENOTFOUND',\n  'ENETUNREACH',\n  'EAI_AGAIN'\n]);\n\nconst STATUS_CODES = new Set([\n  408,\n  413,\n  429,\n  500,\n  502,\n  503,\n  504,\n  521,\n  522,\n  524\n]);\n\n// TODO: we would need to make this easily configurable before adding it in (e.g. some might want to add POST)\n// const METHODS = new Set(['GET', 'PUT', 'HEAD', 'DELETE', 'OPTIONS', 'TRACE']);\n\n/**\n * Determine if a request should be retried.\n * (Inspired by https://github.com/sindresorhus/got#retry)\n *\n * @param {Error} err an error\n * @param {Response} [res] response\n * @returns {Boolean} if segment should be retried\n */\nRequestBase.prototype._shouldRetry = function (err, res) {\n  if (!this._maxRetries || this._retries++ >= this._maxRetries) {\n    return false;\n  }\n\n  if (this._retryCallback) {\n    try {\n      const override = this._retryCallback(err, res);\n      if (override === true) return true;\n      if (override === false) return false;\n      // undefined falls back to defaults\n    } catch (err_) {\n      console.error(err_);\n    }\n  }\n\n  // TODO: we would need to make this easily configurable before adding it in (e.g. some might want to add POST)\n  /*\n  if (\n    this.req &&\n    this.req.method &&\n    !METHODS.has(this.req.method.toUpperCase())\n  )\n    return false;\n  */\n  if (res && res.status && STATUS_CODES.has(res.status)) return true;\n  if (err) {\n    if (err.code && ERROR_CODES.has(err.code)) return true;\n    // Superagent timeout\n    if (err.timeout && err.code === 'ECONNABORTED') return true;\n    if (err.crossDomain) return true;\n  }\n\n  return false;\n};\n\n/**\n * Retry request\n *\n * @return {Request} for chaining\n * @api private\n */\n\nRequestBase.prototype._retry = function () {\n  this.clearTimeout();\n\n  // node\n  if (this.req) {\n    this.req = null;\n    this.req = this.request();\n  }\n\n  this._aborted = false;\n  this.timedout = false;\n  this.timedoutError = null;\n\n  return this._end();\n};\n\n/**\n * Promise support\n *\n * @param {Function} resolve\n * @param {Function} [reject]\n * @return {Request}\n */\n\nRequestBase.prototype.then = function (resolve, reject) {\n  if (!this._fullfilledPromise) {\n    const self = this;\n    if (this._endCalled) {\n      console.warn(\n        'Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises'\n      );\n    }\n\n    this._fullfilledPromise = new Promise((resolve, reject) => {\n      self.on('abort', () => {\n        if (this._maxRetries && this._maxRetries > this._retries) {\n          return;\n        }\n\n        if (this.timedout && this.timedoutError) {\n          reject(this.timedoutError);\n          return;\n        }\n\n        const err = new Error('Aborted');\n        err.code = 'ABORTED';\n        err.status = this.status;\n        err.method = this.method;\n        err.url = this.url;\n        reject(err);\n      });\n      self.end((err, res) => {\n        if (err) reject(err);\n        else resolve(res);\n      });\n    });\n  }\n\n  return this._fullfilledPromise.then(resolve, reject);\n};\n\nRequestBase.prototype.catch = function (cb) {\n  return this.then(undefined, cb);\n};\n\n/**\n * Allow for extension\n */\n\nRequestBase.prototype.use = function (fn) {\n  fn(this);\n  return this;\n};\n\nRequestBase.prototype.ok = function (cb) {\n  if (typeof cb !== 'function') throw new Error('Callback required');\n  this._okCallback = cb;\n  return this;\n};\n\nRequestBase.prototype._isResponseOK = function (res) {\n  if (!res) {\n    return false;\n  }\n\n  if (this._okCallback) {\n    return this._okCallback(res);\n  }\n\n  return res.status >= 200 && res.status < 300;\n};\n\n/**\n * Get request header `field`.\n * Case-insensitive.\n *\n * @param {String} field\n * @return {String}\n * @api public\n */\n\nRequestBase.prototype.get = function (field) {\n  return this._header[field.toLowerCase()];\n};\n\n/**\n * Get case-insensitive header `field` value.\n * This is a deprecated internal API. Use `.get(field)` instead.\n *\n * (getHeader is no longer used internally by the superagent code base)\n *\n * @param {String} field\n * @return {String}\n * @api private\n * @deprecated\n */\n\nRequestBase.prototype.getHeader = RequestBase.prototype.get;\n\n/**\n * Set header `field` to `val`, or multiple fields with one object.\n * Case-insensitive.\n *\n * Examples:\n *\n *      req.get('/')\n *        .set('Accept', 'application/json')\n *        .set('X-API-Key', 'foobar')\n *        .end(callback);\n *\n *      req.get('/')\n *        .set({ Accept: 'application/json', 'X-API-Key': 'foobar' })\n *        .end(callback);\n *\n * @param {String|Object} field\n * @param {String} val\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.set = function (field, value) {\n  if (isObject(field)) {\n    for (const key in field) {\n      if (Object.prototype.hasOwnProperty.call(field, key))\n        this.set(key, field[key]);\n    }\n\n    return this;\n  }\n\n  this._header[field.toLowerCase()] = value;\n  this.header[field] = value;\n  return this;\n};\n\n/**\n * Remove header `field`.\n * Case-insensitive.\n *\n * Example:\n *\n *      req.get('/')\n *        .unset('User-Agent')\n *        .end(callback);\n *\n * @param {String} field field name\n */\nRequestBase.prototype.unset = function (field) {\n  delete this._header[field.toLowerCase()];\n  delete this.header[field];\n  return this;\n};\n\n/**\n * Write the field `name` and `val`, or multiple fields with one object\n * for \"multipart/form-data\" request bodies.\n *\n * ``` js\n * request.post('/upload')\n *   .field('foo', 'bar')\n *   .end(callback);\n *\n * request.post('/upload')\n *   .field({ foo: 'bar', baz: 'qux' })\n *   .end(callback);\n * ```\n *\n * @param {String|Object} name name of field\n * @param {String|Blob|File|Buffer|fs.ReadStream} val value of field\n * @return {Request} for chaining\n * @api public\n */\nRequestBase.prototype.field = function (name, value) {\n  // name should be either a string or an object.\n  if (name === null || undefined === name) {\n    throw new Error('.field(name, val) name can not be empty');\n  }\n\n  if (this._data) {\n    throw new Error(\n      \".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()\"\n    );\n  }\n\n  if (isObject(name)) {\n    for (const key in name) {\n      if (Object.prototype.hasOwnProperty.call(name, key))\n        this.field(key, name[key]);\n    }\n\n    return this;\n  }\n\n  if (Array.isArray(value)) {\n    for (const i in value) {\n      if (Object.prototype.hasOwnProperty.call(value, i))\n        this.field(name, value[i]);\n    }\n\n    return this;\n  }\n\n  // val should be defined now\n  if (value === null || undefined === value) {\n    throw new Error('.field(name, val) val can not be empty');\n  }\n\n  if (typeof value === 'boolean') {\n    value = String(value);\n  }\n\n  this._getFormData().append(name, value);\n  return this;\n};\n\n/**\n * Abort the request, and clear potential timeout.\n *\n * @return {Request} request\n * @api public\n */\nRequestBase.prototype.abort = function () {\n  if (this._aborted) {\n    return this;\n  }\n\n  this._aborted = true;\n  if (this.xhr) this.xhr.abort(); // browser\n  if (this.req) this.req.abort(); // node\n  this.clearTimeout();\n  this.emit('abort');\n  return this;\n};\n\nRequestBase.prototype._auth = function (user, pass, options, base64Encoder) {\n  switch (options.type) {\n    case 'basic':\n      this.set('Authorization', `Basic ${base64Encoder(`${user}:${pass}`)}`);\n      break;\n\n    case 'auto':\n      this.username = user;\n      this.password = pass;\n      break;\n\n    case 'bearer': // usage would be .auth(accessToken, { type: 'bearer' })\n      this.set('Authorization', `Bearer ${user}`);\n      break;\n    default:\n      break;\n  }\n\n  return this;\n};\n\n/**\n * Enable transmission of cookies with x-domain requests.\n *\n * Note that for this to work the origin must not be\n * using \"Access-Control-Allow-Origin\" with a wildcard,\n * and also must set \"Access-Control-Allow-Credentials\"\n * to \"true\".\n *\n * @api public\n */\n\nRequestBase.prototype.withCredentials = function (on) {\n  // This is browser-only functionality. Node side is no-op.\n  if (on === undefined) on = true;\n  this._withCredentials = on;\n  return this;\n};\n\n/**\n * Set the max redirects to `n`. Does nothing in browser XHR implementation.\n *\n * @param {Number} n\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.redirects = function (n) {\n  this._maxRedirects = n;\n  return this;\n};\n\n/**\n * Maximum size of buffered response body, in bytes. Counts uncompressed size.\n * Default 200MB.\n *\n * @param {Number} n number of bytes\n * @return {Request} for chaining\n */\nRequestBase.prototype.maxResponseSize = function (n) {\n  if (typeof n !== 'number') {\n    throw new TypeError('Invalid argument');\n  }\n\n  this._maxResponseSize = n;\n  return this;\n};\n\n/**\n * Convert to a plain javascript object (not JSON string) of scalar properties.\n * Note as this method is designed to return a useful non-this value,\n * it cannot be chained.\n *\n * @return {Object} describing method, url, and data of this request\n * @api public\n */\n\nRequestBase.prototype.toJSON = function () {\n  return {\n    method: this.method,\n    url: this.url,\n    data: this._data,\n    headers: this._header\n  };\n};\n\n/**\n * Send `data` as the request body, defaulting the `.type()` to \"json\" when\n * an object is given.\n *\n * Examples:\n *\n *       // manual json\n *       request.post('/user')\n *         .type('json')\n *         .send('{\"name\":\"tj\"}')\n *         .end(callback)\n *\n *       // auto json\n *       request.post('/user')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // manual x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send('name=tj')\n *         .end(callback)\n *\n *       // auto x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // defaults to x-www-form-urlencoded\n *      request.post('/user')\n *        .send('name=tobi')\n *        .send('species=ferret')\n *        .end(callback)\n *\n * @param {String|Object} data\n * @return {Request} for chaining\n * @api public\n */\n\n// eslint-disable-next-line complexity\nRequestBase.prototype.send = function (data) {\n  const isObject_ = isObject(data);\n  let type = this._header['content-type'];\n\n  if (this._formData) {\n    throw new Error(\n      \".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()\"\n    );\n  }\n\n  if (isObject_ && !this._data) {\n    if (Array.isArray(data)) {\n      this._data = [];\n    } else if (!this._isHost(data)) {\n      this._data = {};\n    }\n  } else if (data && this._data && this._isHost(this._data)) {\n    throw new Error(\"Can't merge these send calls\");\n  }\n\n  // merge\n  if (isObject_ && isObject(this._data)) {\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key))\n        this._data[key] = data[key];\n    }\n  } else if (typeof data === 'string') {\n    // default to x-www-form-urlencoded\n    if (!type) this.type('form');\n    type = this._header['content-type'];\n    if (type) type = type.toLowerCase().trim();\n    if (type === 'application/x-www-form-urlencoded') {\n      this._data = this._data ? `${this._data}&${data}` : data;\n    } else {\n      this._data = (this._data || '') + data;\n    }\n  } else {\n    this._data = data;\n  }\n\n  if (!isObject_ || this._isHost(data)) {\n    return this;\n  }\n\n  // default to json\n  if (!type) this.type('json');\n  return this;\n};\n\n/**\n * Sort `querystring` by the sort function\n *\n *\n * Examples:\n *\n *       // default order\n *       request.get('/user')\n *         .query('name=Nick')\n *         .query('search=Manny')\n *         .sortQuery()\n *         .end(callback)\n *\n *       // customized sort function\n *       request.get('/user')\n *         .query('name=Nick')\n *         .query('search=Manny')\n *         .sortQuery(function(a, b){\n *           return a.length - b.length;\n *         })\n *         .end(callback)\n *\n *\n * @param {Function} sort\n * @return {Request} for chaining\n * @api public\n */\n\nRequestBase.prototype.sortQuery = function (sort) {\n  // _sort default to true but otherwise can be a function or boolean\n  this._sort = typeof sort === 'undefined' ? true : sort;\n  return this;\n};\n\n/**\n * Compose querystring to append to req.url\n *\n * @api private\n */\nRequestBase.prototype._finalizeQueryString = function () {\n  const query = this._query.join('&');\n  if (query) {\n    this.url += (this.url.includes('?') ? '&' : '?') + query;\n  }\n\n  this._query.length = 0; // Makes the call idempotent\n\n  if (this._sort) {\n    const index = this.url.indexOf('?');\n    if (index >= 0) {\n      const queryArray = this.url.slice(index + 1).split('&');\n      if (typeof this._sort === 'function') {\n        queryArray.sort(this._sort);\n      } else {\n        queryArray.sort();\n      }\n\n      this.url = this.url.slice(0, index) + '?' + queryArray.join('&');\n    }\n  }\n};\n\n// For backwards compat only\nRequestBase.prototype._appendQueryString = () => {\n  console.warn('Unsupported');\n};\n\n/**\n * Invoke callback with timeout error.\n *\n * @api private\n */\n\nRequestBase.prototype._timeoutError = function (reason, timeout, errno) {\n  if (this._aborted) {\n    return;\n  }\n\n  const err = new Error(`${reason + timeout}ms exceeded`);\n  err.timeout = timeout;\n  err.code = 'ECONNABORTED';\n  err.errno = errno;\n  this.timedout = true;\n  this.timedoutError = err;\n  this.abort();\n  this.callback(err);\n};\n\nRequestBase.prototype._setTimeouts = function () {\n  const self = this;\n\n  // deadline\n  if (this._timeout && !this._timer) {\n    this._timer = setTimeout(() => {\n      self._timeoutError('Timeout of ', self._timeout, 'ETIME');\n    }, this._timeout);\n  }\n\n  // response timeout\n  if (this._responseTimeout && !this._responseTimeoutTimer) {\n    this._responseTimeoutTimer = setTimeout(() => {\n      self._timeoutError(\n        'Response timeout of ',\n        self._responseTimeout,\n        'ETIMEDOUT'\n      );\n    }, this._responseTimeout);\n  }\n};\n"]},"metadata":{},"sourceType":"script"}